{% extends 'base.html' %}{% block content %}
<h2 class="text-2xl font-semibold mb-4">Doctor Dashboard</h2>

<div class="grid grid-cols-1 gap-6">
  <div class="bg-white rounded shadow p-4">
    <h3 class="font-medium mb-2">Active Appointments</h3>
    <ul class="divide-y">
      {% for a in active %}
        <li class="py-3">
          <div class="flex justify-between items-start">
            <div>
              <div class="text-sm text-gray-600">#{{a.id}} — {{a.patient_name}} — {{a.date}}</div>
              <div class="mt-1">{{a.disease}} • Age: {{a.age}}</div>
              {% if a.reports %}
                <div class="mt-2 text-sm">Reports:
                  {% for fname in a.reports.split(',') %}
                    <a href="{{ url_for('uploaded_report', filename=fname) }}" class="text-indigo-600 text-sm ml-2" target="_blank">{{fname}}</a>
                  {% endfor %}
                </div>
              {% endif %}
            </div>
            <div class="text-right">
              <div class="mb-2"><span class="px-2 py-1 rounded text-sm {{ 'bg-blue-100 text-blue-800' }}">{{a.status}}</span></div>
              <a href="{{ url_for('doctor_confirm', appid=a.id) }}" class="text-sm text-indigo-600">Confirm</a>
            </div>
          </div>
          <form method="post" action="{{ url_for('doctor_prescribe', appid=a.id) }}" class="mt-3 flex space-x-2">
            <input name="medicine" placeholder="Medicine" class="border px-2 py-1 rounded flex-1">
            <input name="notes" placeholder="Notes" class="border px-2 py-1 rounded flex-1">
            <button class="px-3 py-1 bg-green-600 text-white rounded">Prescribe & Complete</button>
          </form>
        </li>
      {% else %}
        <li class="py-3 text-gray-500">No active appointments.</li>
      {% endfor %}
    </ul>
  </div>

  <div class="bg-white rounded shadow p-4">
    <h3 class="font-medium mb-2">History (Completed / Cancelled)</h3>
    <ul class="divide-y">
      {% for a in history %}
        <li class="py-3">
          <div class="flex justify-between">
            <div>
              <div class="text-sm">#{{a.id}} — {{a.patient_name}} — {{a.date}}</div>
              <div class="text-sm text-gray-600">{{a.disease}} • Age: {{a.age}}</div>
              {% if a.medicine %}<div class="mt-1 text-sm"><strong>Medicine:</strong> {{a.medicine}}</div>{% endif %}
              {% if a.notes %}<div class="text-sm"><strong>Notes:</strong> {{a.notes}}</div>{% endif %}
              {% if a.reports %}
                <div class="mt-2 text-sm">Reports:
                  {% for fname in a.reports.split(',') %}
                    <a href="{{ url_for('uploaded_report', filename=fname) }}" class="text-indigo-600 text-sm ml-2" target="_blank">{{fname}}</a>
                  {% endfor %}
                </div>
              {% endif %}
            </div>
            <div class="text-right"><span class="px-2 py-1 rounded text-sm {{ 'bg-green-100 text-green-800' if a.status=='Completed' else 'bg-red-100 text-red-800' }}">{{a.status}}</span></div>
          </div>
        </li>
      {% else %}
        <li class="py-3 text-gray-500">No history yet.</li>
      {% endfor %}
    </ul>
  </div>
</div>

{% endblock %}